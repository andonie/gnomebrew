{% extends "stations/_station.html" %}

{% block station_actions %}<div class="gb-toggle-view gb-toggle-view-active" data-toggles="#gb-sidebar-left" id="storage-close-button" aria-label="Close" data-display="#storage-icon" data-inform=".gb-main">
    {{ icon('special.cancel') | safe }}
</div>{% endblock %}

{% block infos %}
<div class="gb-info gb-info-default" title="Storage Capacity">
    {{ icon('attr.storage.max_capacity', class='gb-icon-sm') | safe }}
    <span class="attr-storage-max_capacity">{{ shorten_num(current_user.get('attr.storage.max_capacity', id_buffer=buffer)) }}</span>
</div>
{% endblock %}

{% block station_body %}
{% with category_data = get_available_category_data(current_user, storage_ui=True), player_inventory = current_user.get('storage._content', id_buffer=buffer) %}
<div class="gb-storage-categories">
{% for data_object in category_data %}
    {% with category = data_object.category %}
    <button class="storage-category-button gb-toggle-button gb-toggle-view {% if data_object.visible %}gb-toggle-view-active{% endif %}"
            data-toggles=".{{ css_friendly(category.get_id()) }}" id="{{ css_friendly(category.get_id()) }}-toggle" data-display="#{{ css_friendly(category.get_id()) }}-toggle" data-sync="selection._bool.cat_{{ category.get_minimized_id() }}_visible">
        {{ icon( category.get_id(), class='gb-icon-sm') | safe }}
    </button>
    {% endwith %}
{% endfor %}
</div>
<input type="text" id="storage-filter" class="gb-filter" placeholder="Filter Storage" data-filters=".gb-storage-item-view">
<div class="gb-storage-category-view">

    {% for data_object in category_data %}
    {% with category=data_object['category'], cat_collapsed=data_object['collapsed'], cat_visible=data_object['visible'] %}{% with category_selection_id = current_user.get('selection.' + category.get_id()) %}
    <div class="gb-storage-category {{ css_friendly(category.get_id()) }} gb-foldout {% if not data_object.visible %}gb-toggle-hidden{% endif %}">
        <div class="gb-category-header gb-toggle-view" data-toggles="#{{ css_friendly(category.get_id()) }}-items">
            {{ icon(category.get_id(), class='gb-icon-sm') | safe }}
            <div class="gb-category-heading-banner">{{ category.name() }}</div>
            <div class="gb-info">
                {{ icon('special.item_category_selected', class='gb-icon-sm') | safe }}
                {{ icon(category_selection_id, class='gb-icon-sm selection-it_cat-' + css_friendly(category.get_minimized_id()), id_buffer=buffer) | safe  }}
            </div>
        </div>
        <div class="gb-storage-category-items gb-info-container gb-foldout" id="{{ css_friendly(category.get_id()) }}-items">
            {% for item in category.get_matching_items() %}
            {% if item.get_minimized_id() in player_inventory %}
            <div class="gb-storage-item-view gb-info gb-info-highlight {{ css_friendly(category.get_id()) }}-option {% if item.get_id() == current_user.get('data.storage.it_cat_selections.' + category.get_minimized_id(), default=None, id_buffer=buffer) %}gb-selected{% endif %}" data-filter-match="{{ category.name() }} {{ item.name() }}" title="{{ item.name() }}"
                 data-select-value="{{ item.get_id() }}" data-peers=".{{ css_friendly(category.get_id()) }}-option" onclick="select('selection.{{ category.get_id() }}', this)">
                {{ icon(item.get_id(), class='gb-icon-sm') | safe }}
                <span class="storage-{{ css_friendly(item.get_minimized_id()) }}" data-value="{{ player_inventory[item.get_minimized_id()] }}">{{ shorten_num(player_inventory[item.get_minimized_id()]) }}</span>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
{% endwith %}{% endwith %}
{% endfor %}
</div>
{% endwith %}
<div class="gb-storage-detail-view"></div>
{% endblock %}
